<div class="page-container">
  <div class="page-header">
    <div>
      <h3 class="mb-1 fw-bold">Generate Certificate</h3>
      <p class="text-muted mb-0">Fill in the details to create a new certificate</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-card">
    <div class="spinner-border text-secondary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 mb-0 text-muted">Loading form fields...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger custom-alert">
    <i class="bi bi-exclamation-circle me-2"></i>{{ error }}
  </div>

  <!-- Certificate Form -->
  <div *ngIf="!loading && schema && form" class="form-card">
    <div class="form-icon-wrapper mb-4">
      <i class="bi bi-file-earmark-text-fill"></i>
    </div>
    
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div *ngFor="let key of (schema?.required || [])" class="mb-4">
        <label [for]="key" class="form-label fw-semibold">
          {{ key.replace('_', ' ') | titlecase }}
          <span class="text-danger">*</span>
        </label>
        <input 
          class="form-control custom-input" 
          [id]="key" 
          [formControlName]="key"
          [placeholder]="'Enter ' + (key.replace('_', ' ') | titlecase)"
          [attr.required]="schema.required.includes(key) ? true : null"
        />
        <div *ngIf="form.get(key)?.touched && form.get(key)?.invalid" class="validation-error">
          <i class="bi bi-exclamation-circle me-1"></i>This field is required
        </div>
      </div>

      <div class="form-actions">
        <button class="btn-generate" type="submit" [disabled]="form.invalid || loading">
          <i class="bi bi-file-earmark-pdf me-2"></i>
          Generate Certificate
        </button>
      </div>
    </form>
  </div>

  <!-- Success Modal Overlay -->
  <div *ngIf="generatedId" class="modal-overlay" (click)="generatedId = null">
    <div class="success-modal" (click)="$event.stopPropagation()">
      <button (click)="generatedId = null" class="btn-close-icon">
        <i class="bi bi-x-lg"></i>
      </button>
      <div class="success-icon mb-3">
        <i class="bi bi-check-circle-fill"></i>
      </div>
      <h5 class="fw-bold mb-2">Certificate Generated!</h5>
      <p class="text-muted mb-4">Your certificate is ready to download</p>
      <button (click)="downloadPdf()" class="btn-download">
        <i class="bi bi-download me-2"></i>Download Certificate PDF
      </button>
    </div>
  </div>
</div>